# Constants
APPNAME = "TangemLite"
ADHOC_PROVISION = "Ad Hoc Provisioning Profile"
APPSTORE_PROVISION = "App Store Provisioning Profile"

lane :test_flight do
  build_number = get_build_number(xcodeproj: "Tangem.xcodeproj")
  build_number = (build_number.to_i + 1).to_s
  increment_build_number(
    build_number: build_number,
    xcodeproj: "Tangem.xcodeproj",
  )
  build_app(scheme: "Tangem")
  upload_to_app_store(
    username: "bergencroc@gmail.com",
    force: true
  )
  git_commit(
   path: "*", 
   message: "Build bump [" + build_number + "]"
  )
  add_git_tag(
   grouping: "fastlane-builds",
   prefix: "v",
   build_number: build_number
  )
  push_to_git_remote
end

lane :buildAppStore do |options|
  increment_version_number(
  	version_number: options[:versionName]
  )

  increment_build_number(
    build_number: options[:versionCode]
  )


  build_app(
    output_name: APPNAME + "-release",
    scheme: "Tangem",
    export_method: "app-store",
    clean: true,
    silent: true,
    configuration: "Release",
    export_options: {
      provisioningProfiles: { 
        BUNDLE_NAME => APPSTORE_PROVISION
      }
    }
  )

end

lane :buildAdHoc do |options|

  increment_version_number(
  	version_number: options[:versionName]
  )

  increment_build_number(
    build_number: options[:versionCode]
  )

  build_app(
    output_name: APPNAME + "-adhoc",
    scheme: "Tangem beta",
    export_method: "ad-hoc",
    clean: true,
    silent: true,
    configuration: "Release",
    export_options: {
      provisioningProfiles: { 
        BUNDLE_NAME => ADHOC_PROVISION
      }
    }
  )

end

lane :test do
run_tests(scheme: "Tangem")
end
