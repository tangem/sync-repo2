name: Alpha - Build and Deploy 

on:
  workflow_dispatch:
  
jobs:
 build:
   name: Build
   runs-on: self-hosted
   if: github.event.pull_request.draft == false
   steps:
   - name: Checkout
     uses: actions/checkout@v3
     with:
       submodules: true
       token: ${{ secrets.GH_MOBILE_PAT }}
       
   - name: Bundle install
     run: |
       bundle install --jobs 4 --retry 3
      
   - name: Pods install
     run: bundle exec pod install
      
   - name: Tests
     run: bundle exec fastlane test
     
 deploy:
   name: Build
     needs: build
     runs-on: self-hosted
